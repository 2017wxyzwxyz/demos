<!DOCTYPE html>
<html lang="en">
<head>
  <title>Stocks Prediction (TFJS)</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script src="./model.js"></script>
  <script src="./index.js"></script>

  <style>
    .row {
      margin-bottom: 1rem;
    }
  </style>

</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <!-- <a class="navbar-brand">Stocks Prediction (TFJS)</a> -->

    <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
      </ul>
    </div> -->
  </nav>

  <div class="jumbotron">
    <h1 class="display-4">Time Series Forcasting with TensorFlow.js</h1>
    <p class="lead">
      Pull stock prices from online API and perform predictions using Recurrent Neural Network and Long Short-Term Memory (LSTM) with TensorFlow.js framework
    </p>
    <hr class="my-4">
    <p>
      <!-- [write about the purpose for this experiment] -->
      As machine learning is very popular in these days, some people even thinks of it as a magic crystal ball, expect it to tell us what will happen in the future. This experiment uses artificial neural networks to reveal stocks market trends and demonstrates time series forecasting to predict future stocks prices based on historical data from the past.
    </p>
    <p>
      <!-- [disclaimer] -->
      As changes in stocks prices on the market are dynamic and affected by multiple factors, which is typically unpredictable, this experiment is 100% educational and is by no means a trading prediction tool.
    </p>
    <p>
      <!-- [how to use this experiment, outline] -->
      There are 4 parts in this experiment:
      <ol>
        <li>get historical stocks prices data</li>
        <li>prepare training data for our neural network model</li>
        <li>training the neural network</li>
        <li>do some prediction</li>
      </ol>
      You can either begin by scrolling down to explore each step or hit the <i>Load Snapshot Demo</i> button.
    </p>
    <button class="btn btn-primary" type="button" onclick="demo()">
      Load Snapshot Demo
    </button>
  </div>


  <div class="jumbotron" style="background-color:#ffebee">
    <h1 class="display-4">Get Stocks Data</h1>
    <p class="lead">

    </p>
    <p>
      <!-- [purpose of this step, fun for the reader] -->
      Before we can train our neural network and make any prediction, we need data. The type of data we are looking for is time series, a sequence of numbers, ordered chronologically. I fetch stocks data from <a href="https://www.alphavantage.co" target="_blank">alphavantage.co</a>, this API returns 20 years of chronological data on a certain company stocks prices. The API returns the following fields:
      <ol>
        <li>open price</li>
        <li>highest price of that day</li>
        <li>lowest price of that day</li>
        <li>closing price</li>
        <li>volume</li>
      </ol>
      To prepare training dataset for our neural network, I picked closing stocks price. This also means that I am predicting future closing price.
    </p>
    <p>
      <!-- [how to use, what you want your reader to do after you end, as simple and obvious] -->
      You can use <i>demo</i> API key to fetch <i>Microsoft Corporation</i> prices or <a href="https://www.alphavantage.co/support/#api-key" target="_blank">get your own API key</a> for other stocks.
    </p>

    <div class="container">

      <div class="row" id="div_container_getdata">
        <div class="col-sm">
          <div class="form-group">
            <label for="input_ticker">Ticker Symbol</label>
            <input type="text" class="form-control" id="input_ticker" placeholder="example: MSFT" value="MSFT">
            <small class="form-text text-muted">Demo API key only allows 'MSFT'</small>
          </div>
          <button class="btn btn-primary" id="btn_fetch_data" onclick="onClickFetchData()">Fetch Data</button>
          <div class="spinner-border" id="load_fetch_data" style="display:none"></div>
        </div>
        <div class="col-sm">
          <div class="form-group">
            <label for="input_apikey">Alpha Vantage API Key</label>
            <input type="text" class="form-control" id="input_apikey" placeholder="Input your API key or use 'demo'" value="demo">
            <small class="form-text text-muted">You can claim your API key from <a href="https://www.alphavantage.co/support/#api-key" target="_blank">alphavantage.co</a></small>
          </div>
        </div>
        <div class="col-sm">
          <div class="dropdown">

            <div class="form-group">
              <label for="input_apikey">Data Temporal Resolutions</label>
              <button class="btn btn-secondary dropdown-toggle" type="button" id="input_datafreq" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Weekly
              </button>
              <div class="dropdown-menu" aria-labelledby="input_datafreq">
                <a class="dropdown-item" onclick="onClickChangeDataFreq('Weekly')">Weekly</a>
                <a class="dropdown-item" onclick="onClickChangeDataFreq('Daily')">Daily</a>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="row" id="div_container_linegraph" style="display:none">
        <div class="col-sm">
          <div class="card">
            <h5 class="card-header" id="div_linegraph_data_title"></h5>
            <div class="card-body">
              <div id="div_linegraph_data" style="width:100%; height:350px;"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="jumbotron" style="background-color:#e3f2fd">
    <h1 class="display-4">Simple Moving Average</h1>
    <p class="lead"></p>
    <p>
      <!-- [purpose of this step, fun for the reader] -->
      For this experiment, we are doing <a href="https://en.wikipedia.org/wiki/Supervised_learning" target="_blank">supervised learning</a>, which means feeding data to the neural network and it learns by mapping input data to the output label. One way to prepare the training dataset is to extract Simple Moving Average from that time series data.
    </p>
    <p>
      Simple Moving Average (SMA) is a way to identify trends direction for a certain period of time, by looking at the average of all the values within that time window. The number of prices in a time window is selected experimentally. So let's say the closing prices for past 5 days were 13, 15, 14, 16, 17, the SMA would be (13+15+14+16+17)/5 = 15. So the <i>input</i> for our training dataset is the set of prices within a single time window, and <i>label</i> is the computed moving average of those prices. <a href="https://www.investopedia.com/terms/s/sma.asp" target="_blank">Learn more about SMA</a>.
    </p>

    <div class="container">

      <div class="row" id="div_container_getsmafirst">
        <div class="col-sm-12">
          <p>But first, fetch stocks data from the previous step.</p>
        </div>
      </div>

      <div class="row" id="div_container_getsma" style="display:none">
        <div class="col-sm-12">
          <p>
            <!-- [how to use, what you want your reader to do after you end, as simple and obvious] -->
            Let's generate the training dataset, hit on the <i>Compute SMA and Draw Chart</i> button to generate the training data for the neural network.
          </p>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label for="input_windowsize">Window Size</label>
            <input type="number" class="form-control" id="input_windowsize" placeholder="a number" value="50">
            <small class="form-text text-muted">This is the "time window" for SMA</small>
          </div>
          <button class="btn btn-primary" id="btn_draw_sma" onclick="onClickDisplaySMA()">Compute SMA and Draw Chart</button>
          <div class="spinner-border" id="load_draw_sma" style="display:none"></div>
        </div>
      </div>

      <div class="row" id="div_container_sma" style="display:none">
        <div class="col-sm">
          <div class="card">
            <h5 class="card-header" id="div_linegraph_sma_title"></h5>
            <div class="card-body">
              <div id="div_linegraph_sma" style="width:100%; height:350px;"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" id="div_container_trainingdata" style="display:none">
        <div class="col-sm">
          <div class="card">
            <h5 class="card-header">Training Data (top 25 rows)</h5>
            <div class="card-body">
              <div class="table-responsive" id="div_trainingdata">
            </div>
          </div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="jumbotron" style="background-color:#e8f5e9">
    <h1 class="display-4">Train Neural Network</h1>
    <p class="lead"></p>
    <p>
      <!-- [purpose of this step, fun for the reader] -->
      Now with the training data, we are ready to create a model for time series prediction, to achieve this we will use <a href="https://js.tensorflow.org/" target="
      ">TensorFlow.js</a> framework.
    </p>
    <p>
      <a href="https://js.tensorflow.org/api/latest/#sequential" target="_blank">Sequential model</a> is selected which simply connects each layer and pass the data from input to the output during the training process. In order for the model to learn time series data which are sequential, <a href="https://js.tensorflow.org/api/latest/#layers.rnn" target="_blank">recurrent neural network (RNN) layer</a> is created and a number of <a href="https://js.tensorflow.org/api/latest/#layers.lstmCell" target="_blank">LSTM cells</a> are added to the RNN.
    </p>
    <p>
      The model will be trained using <a href="https://js.tensorflow.org/api/latest/#train.adam" target="_blank">Adam</a> (<a href="https://arxiv.org/abs/1412.6980" target="_blank">read more</a>), a popular optimisation algorithm for machine learning.
      <a href="https://js.tensorflow.org/api/latest/#losses.meanSquaredError" target="_blank">Root-means-squared error</a> which determine the difference between predicted values and the actual values, so model is able to learn by minimsing the error during the training process.
    </p>
    <p>
      <!-- [how to use, what you want your reader to do after you end, as simple and obvious] -->
      These are the hyperparameters (parameters used in the training process) available for tweaking:
      <ol>
        <li>Training Dataset Size (%): the amount of data used for training, and remaining data will be used for prediction</li>
        <li>Epochs: number of times the dataset is used to train the model (<a href="https://machinelearningmastery.com/difference-between-a-batch-and-an-epoch/" target="_blank">learn more</a>)</li>
        <li>Learning Rate: amount of change in the weights during training in each step (<a href="https://machinelearningmastery.com/learning-rate-for-deep-learning-neural-networks/" target="_blank">learn more</a>)</li>
        <li>Hidden LSTM Layers: to increase the model complexity to learn in higher dimensional space (<a href="https://machinelearningmastery.com/how-to-configure-the-number-of-layers-and-nodes-in-a-neural-network/" target="_blank">learn more</a>)</li>
      </ol>
    </p>

    <div class="container">

      <div class="row" id="div_container_trainfirst">
        <div class="col-sm-12">
          <p>Need training data, explore the previous section to prepare training data.</p>
        </div>
      </div>

      <div id="div_container_train" style="display:none">
        <div class="row">
          <div class="col-sm-12">
            <p>
              <!-- [how to use, what you want your reader to do after you end, as simple and obvious] -->
              You may tweak the hyperparameters and then hit the <i>Begin Training Model</i> button to train the model.
            </p>
          </div>
          <div class="col-sm">
            <div class="form-group">
              <label for="input_trainingsize">Training Dataset Size (%)</label>
              <input type="number" class="form-control" id="input_trainingsize" placeholder="a number between (1-99)" value="70">
            </div>
          </div>
          <div class="col-sm">
            <div class="form-group">
              <label for="input_epochs">Epochs</label>
              <input type="number" class="form-control" id="input_epochs" placeholder="a number" value="50">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm">
            <div class="form-group">
              <label for="input_learningrate">Learning Rate</label>
              <input type="number" class="form-control" id="input_learningrate" placeholder="a decimal'" value="0.01">
              <small class="form-text text-muted">Typically range between 0.01 and 0.1</small>
            </div>
            <button class="btn btn-primary" id="btn_draw_trainmodel" onclick="onClickTrainModel()">Begin Training Model</button>
          </div>
          <div class="col-sm">
            <div class="form-group">
              <label for="input_hiddenlayers">Hidden LSTM Layers</label>
              <input type="number" class="form-control" id="input_hiddenlayers" placeholder="a number'" value="4">
              <small class="form-text text-muted">Number of LSTM layers</small>
            </div>
          </div>
        </div>
      </div>

      <div class="row" id="div_container_training" style="display:none">
        <div class="col-sm">
          <div class="card">
            <h5 class="card-header">Training Model</h5>
            <div class="card-body">
              <h6>Progress</h6>
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" id="div_training_progressbar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
              </div>
              <hr/>
              <h6>Loss</h6>
              <div id="div_linegraph_trainloss" style="width:100%; height:250px;"></div>
              <hr/>
              <h6>Logs</h6>
              <div id="div_traininglog" style="overflow-x: scroll; overflow-y: scroll; height: 250px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="jumbotron" style="background-color:#fffde7">
    <h1 class="display-4">Prediction</h1>
    <p class="lead"></p>
    <p>
      <!-- [purpose of this step, fun for the reader] -->
      After training our model, it's time to use it for predicting future values, for our case, its the moving average. We actually using the remaining data for prediction, this allow us to see how closely our predicted values are compared to the actual values.
    </p>


    <div class="container">

      <div class="row" id="div_container_predictfirst">
        <div class="col-sm-12">
          <p>Require a model to perform prediction, train model first.</p>
        </div>
      </div>

      <div class="row" id="div_container_predict" style="display:none">
        <div class="col-sm-12">
          <p>
            <!-- [how to use, what you want your reader to do after you end, as simple and obvious] -->
            Hit the <i>Make Prediction</i> button to see how this model performs. Whohoo!
          </p>
        </div>
        <div class="col-sm-6">
          <button class="btn btn-primary" id="btn_makeprediction" onclick="onClickPredict()">Make Prediction</button>
          <div class="spinner-border" id="load_predicting" style="display:none"></div>
        </div>
      </div>
      <div class="row" id="div_container_predicting" style="display:none">
        <div class="col-sm">
          <div class="card">
            <h5 class="card-header" id="div_predict_title">Predict Results</h5>
            <div class="card-body">
              <div id="div_predict_graph"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

</body>
</html>
